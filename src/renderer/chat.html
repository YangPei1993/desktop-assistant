<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>manman</title>
    <link rel="stylesheet" href="./chat.css" />
  </head>
  <body>
    <div class="window">
      <header class="topbar drag-region">
        <div class="title">manman</div>
        <div class="actions no-drag">
          <button id="settings-btn" class="icon-btn" title="Settings">Settings</button>
          <button id="clear-btn" class="icon-btn" title="Clear conversation">Clear</button>
          <button id="hide-btn" class="icon-btn" title="Hide window">Hide</button>
        </div>
      </header>

      <section class="workdir-row no-drag">
        <span class="provider-label">Run</span>
        <select id="channel-select" class="provider-select">
          <option value="cli:codex">CLI · Codex</option>
        </select>
        <button id="channel-switch-btn" class="icon-btn provider-switch-btn" title="Switch runtime channel">Switch</button>
        <span class="workdir-label">Dir</span>
        <input id="workdir-input" type="text" autocomplete="off" spellcheck="false" />
        <button id="workdir-pick-btn" class="icon-btn workdir-pick-btn" title="Choose work directory">Pick</button>
        <button id="workdir-apply-btn" class="icon-btn workdir-apply-btn" title="Apply work directory">Apply</button>
      </section>

      <main id="messages" class="messages"></main>

      <section class="composer no-drag">
        <div id="attachment-list" class="attachment-list"></div>

        <textarea
          id="text-input"
          placeholder="Type message... (Enter to send, Shift+Enter newline)"
          rows="3"
        ></textarea>

        <div class="toolbar">
          <label class="file-btn" title="Attach images/files">
            <input id="file-input" type="file" multiple />
            Attach
          </label>

          <button id="voice-btn" class="file-btn" title="Record voice">Voice</button>

          <div class="spacer"></div>

          <button id="live-btn" class="live-btn" title="Live watch current screen and proactively discuss">Live</button>
          <button id="auto-btn" class="auto-btn" title="Run desktop automation with current input">Auto</button>
          <button id="send-btn" class="send-btn">Send</button>
        </div>

        <div id="status-line" class="status-line">Ready</div>
      </section>
    </div>

    <div id="settings-modal" class="settings-modal hidden">
      <div class="settings-panel no-drag">
        <div class="settings-header">
          <div class="settings-title">Settings</div>
          <button id="settings-close-btn" class="icon-btn" title="Close settings">Close</button>
        </div>
        <div class="settings-body">
          <div class="settings-tab-nav" role="tablist" aria-label="Settings tabs">
            <button
              id="settings-tab-api"
              class="settings-tab-btn active"
              type="button"
              role="tab"
              aria-selected="true"
              aria-controls="settings-panel-api"
              data-settings-tab="api"
            >
              API
            </button>
            <button
              id="settings-tab-live"
              class="settings-tab-btn"
              type="button"
              role="tab"
              aria-selected="false"
              aria-controls="settings-panel-live"
              data-settings-tab="live"
            >
              Live
            </button>
            <button
              id="settings-tab-theme"
              class="settings-tab-btn"
              type="button"
              role="tab"
              aria-selected="false"
              aria-controls="settings-panel-theme"
              data-settings-tab="theme"
            >
              Theme
            </button>
            <button
              id="settings-tab-skills"
              class="settings-tab-btn"
              type="button"
              role="tab"
              aria-selected="false"
              aria-controls="settings-panel-skills"
              data-settings-tab="skills"
            >
              Skills
            </button>
            <button
              id="settings-tab-agents"
              class="settings-tab-btn"
              type="button"
              role="tab"
              aria-selected="false"
              aria-controls="settings-panel-agents"
              data-settings-tab="agents"
            >
              Agents
            </button>
            <button
              id="settings-tab-permissions"
              class="settings-tab-btn"
              type="button"
              role="tab"
              aria-selected="false"
              aria-controls="settings-panel-permissions"
              data-settings-tab="permissions"
            >
              Permissions
            </button>
            <button
              id="settings-tab-about"
              class="settings-tab-btn"
              type="button"
              role="tab"
              aria-selected="false"
              aria-controls="settings-panel-about"
              data-settings-tab="about"
            >
              About
            </button>
          </div>

          <div class="settings-tab-panels">
            <section
              id="settings-panel-api"
              class="settings-tab-panel active"
              role="tabpanel"
              aria-labelledby="settings-tab-api"
              data-settings-panel="api"
            >
              <div class="settings-group-title">Defaults</div>
              <div class="settings-field">
                <label for="default-channel-select">Default Run Channel</label>
                <div class="settings-inline">
                  <select id="default-channel-select" class="provider-select"></select>
                  <button
                    id="default-channel-save-btn"
                    class="icon-btn"
                    title="Save default run channel"
                  >
                    Save
                  </button>
                </div>
              </div>

              <div class="settings-group-title">Cloud API</div>
              <div class="settings-field">
                <label for="api-template-select">Provider Template</label>
                <div class="settings-inline">
                  <select id="api-template-select" class="provider-select api-template-select">
                    <option value="openai">OpenAI</option>
                    <option value="azure">Azure OpenAI</option>
                    <option value="custom">Custom</option>
                  </select>
                  <button id="api-template-fill-btn" class="icon-btn api-template-fill-btn" title="Fill API template">
                    Fill
                  </button>
                </div>
              </div>
              <div class="settings-field">
                <label for="api-base-input">Base URL</label>
                <input
                  id="api-base-input"
                  type="text"
                  autocomplete="off"
                  spellcheck="false"
                  placeholder="https://api.openai.com/v1"
                />
              </div>
              <div class="settings-field">
                <label for="api-model-input">Model / Deployment</label>
                <input id="api-model-input" type="text" autocomplete="off" spellcheck="false" placeholder="model name" />
              </div>
              <div class="settings-field">
                <label for="api-key-input">API Key</label>
                <input
                  id="api-key-input"
                  type="password"
                  autocomplete="off"
                  spellcheck="false"
                  placeholder="API key (leave empty to keep)"
                />
              </div>
              <div class="settings-actions">
                <button id="api-save-btn" class="send-btn" title="Save API config">Save API</button>
              </div>
            </section>

            <section
              id="settings-panel-live"
              class="settings-tab-panel"
              role="tabpanel"
              aria-labelledby="settings-tab-live"
              data-settings-panel="live"
            >
              <div class="settings-group-title">Live Watch</div>
              <div class="settings-field">
                <label for="live-interval-input">Capture Interval (ms)</label>
                <input id="live-interval-input" type="number" min="2000" max="30000" step="100" autocomplete="off" spellcheck="false" />
              </div>
              <div class="settings-field">
                <label for="live-summary-frames-input">Rolling Context Frames</label>
                <input id="live-summary-frames-input" type="number" min="2" max="12" step="1" autocomplete="off" spellcheck="false" />
              </div>
              <div class="settings-field">
                <label for="live-max-image-frames-input">Max In-Memory Images</label>
                <input id="live-max-image-frames-input" type="number" min="6" max="60" step="1" autocomplete="off" spellcheck="false" />
              </div>
              <div class="settings-field">
                <label for="live-max-images-analysis-input">Max Images Per Analysis</label>
                <input id="live-max-images-analysis-input" type="number" min="1" max="12" step="1" autocomplete="off" spellcheck="false" />
              </div>
              <div class="settings-field">
                <label for="live-text-only-rounds-input">Text-Only Rounds Before Visual Refresh</label>
                <input id="live-text-only-rounds-input" type="number" min="1" max="10" step="1" autocomplete="off" spellcheck="false" />
              </div>
              <div class="settings-actions">
                <button id="live-save-btn" class="icon-btn" title="Save live watch config">Save Live</button>
              </div>
            </section>

            <section
              id="settings-panel-theme"
              class="settings-tab-panel"
              role="tabpanel"
              aria-labelledby="settings-tab-theme"
              data-settings-panel="theme"
            >
              <div class="settings-group-title">Appearance</div>
              <div class="settings-field">
                <label for="ui-theme-select">Theme</label>
                <div class="settings-inline">
                  <select id="ui-theme-select" class="provider-select">
                    <option value="dark">Current (Dark)</option>
                    <option value="light">White</option>
                  </select>
                  <button id="ui-theme-save-btn" class="icon-btn" title="Save theme">Save Theme</button>
                </div>
              </div>
              <div class="settings-note">
                Theme will be applied to both the chat window and floating bubble, keeping the visual style consistent.
              </div>
            </section>

            <section
              id="settings-panel-skills"
              class="settings-tab-panel"
              role="tabpanel"
              aria-labelledby="settings-tab-skills"
              data-settings-panel="skills"
            >
              <div class="settings-group-title">Skill Runtime</div>
              <div id="skills-runtime-note" class="settings-note">Skills info loading...</div>
              <div class="settings-actions">
                <button id="skills-refresh-btn" class="icon-btn">Refresh</button>
                <button id="skills-open-root-btn" class="icon-btn">Open Skills Folder</button>
              </div>

              <div class="settings-group-title">Installed Skills</div>
              <div id="skills-installed-list" class="settings-list"></div>

              <div class="settings-group-title">Install from Curated List</div>
              <div class="settings-field">
                <label for="skills-curated-select">Curated Skills (openai/skills)</label>
                <div class="settings-inline">
                  <select id="skills-curated-select" class="provider-select"></select>
                  <button id="skills-curated-refresh-btn" class="icon-btn">Reload</button>
                  <button id="skills-install-curated-btn" class="icon-btn">Install</button>
                </div>
              </div>

              <div class="settings-group-title">Install from GitHub</div>
              <div class="settings-field">
                <label for="skills-github-url-input">GitHub URL or owner/repo</label>
                <input
                  id="skills-github-url-input"
                  type="text"
                  autocomplete="off"
                  spellcheck="false"
                  placeholder="https://github.com/openai/skills/tree/main/skills/.curated/playwright"
                />
              </div>
              <div class="settings-field">
                <label for="skills-github-path-input">Path inside repo (optional when URL already has path)</label>
                <div class="settings-inline">
                  <input
                    id="skills-github-path-input"
                    type="text"
                    autocomplete="off"
                    spellcheck="false"
                    placeholder="skills/.curated/skill-name"
                  />
                  <button id="skills-install-github-btn" class="icon-btn">Install GitHub</button>
                </div>
              </div>

              <div class="settings-group-title">Create Skill (Skill Creator)</div>
              <div class="settings-field">
                <label for="skill-create-name-input">Skill Name</label>
                <input id="skill-create-name-input" type="text" autocomplete="off" spellcheck="false" placeholder="my-new-skill" />
              </div>
              <div class="settings-field">
                <label for="skill-create-path-input">Output Directory</label>
                <input id="skill-create-path-input" type="text" autocomplete="off" spellcheck="false" placeholder="~/.codex/skills" />
              </div>
              <div class="settings-field">
                <label for="skill-create-resources-input">Resources (comma-separated)</label>
                <input
                  id="skill-create-resources-input"
                  type="text"
                  autocomplete="off"
                  spellcheck="false"
                  placeholder="scripts,references,assets"
                />
              </div>
              <div class="settings-field">
                <label for="skill-create-display-name-input">Display Name (optional)</label>
                <input id="skill-create-display-name-input" type="text" autocomplete="off" spellcheck="false" placeholder="Skill Display Name" />
              </div>
              <div class="settings-field">
                <label for="skill-create-short-description-input">Short Description (optional, 25-64 chars)</label>
                <input
                  id="skill-create-short-description-input"
                  type="text"
                  autocomplete="off"
                  spellcheck="false"
                  placeholder="Help with X tasks and workflows"
                />
              </div>
              <div class="settings-field">
                <label for="skill-create-default-prompt-input">Default Prompt (optional)</label>
                <textarea id="skill-create-default-prompt-input" rows="2" spellcheck="false" placeholder="What this skill should do by default"></textarea>
              </div>
              <div class="settings-actions">
                <button id="skill-open-selected-btn" class="icon-btn">Open Selected</button>
                <button id="skill-validate-btn" class="icon-btn">Validate Selected</button>
                <button id="skill-create-btn" class="send-btn">Create Skill</button>
              </div>
              <div id="skills-status-note" class="settings-note">Select or create a skill to continue.</div>
            </section>

            <section
              id="settings-panel-agents"
              class="settings-tab-panel"
              role="tabpanel"
              aria-labelledby="settings-tab-agents"
              data-settings-panel="agents"
            >
              <div class="settings-group-title">Store</div>
              <div id="agents-store-note" class="settings-note">Agents/workflows loading...</div>

              <div class="settings-group-title">Agents</div>
              <div class="settings-field">
                <label for="agent-select">Select Agent</label>
                <div class="settings-inline">
                  <select id="agent-select" class="provider-select"></select>
                  <button id="agent-new-btn" class="icon-btn">New</button>
                  <button id="agent-delete-btn" class="icon-btn">Delete</button>
                </div>
              </div>
              <div class="settings-field">
                <label for="agent-name-input">Name</label>
                <input id="agent-name-input" type="text" autocomplete="off" spellcheck="false" placeholder="Inbox Agent" />
              </div>
              <div class="settings-field">
                <label for="agent-channel-select">Preferred Channel</label>
                <select id="agent-channel-select" class="provider-select">
                  <option value="">Follow active</option>
                  <option value="cli:codex">CLI · Codex</option>
                  <option value="cli:claude">CLI · Claude</option>
                  <option value="api">API</option>
                </select>
              </div>
              <div class="settings-field">
                <label for="agent-skills-input">Skill Hints (comma-separated)</label>
                <input id="agent-skills-input" type="text" autocomplete="off" spellcheck="false" placeholder="playwright,spreadsheet,doc" />
              </div>
              <div class="settings-field">
                <label for="agent-prompt-input">System Prompt</label>
                <textarea id="agent-prompt-input" rows="3" spellcheck="false" placeholder="Agent role and constraints"></textarea>
              </div>
              <div class="settings-inline settings-toggle-line">
                <input id="agent-enabled-input" type="checkbox" />
                <label for="agent-enabled-input">Enabled</label>
              </div>
              <div class="settings-actions">
                <button id="agent-save-btn" class="icon-btn">Save Agent</button>
              </div>

              <div class="settings-group-title">Workflows</div>
              <div class="settings-field">
                <label for="workflow-select">Select Workflow</label>
                <div class="settings-inline">
                  <select id="workflow-select" class="provider-select"></select>
                  <button id="workflow-new-btn" class="icon-btn">New</button>
                  <button id="workflow-delete-btn" class="icon-btn">Delete</button>
                </div>
              </div>
              <div class="settings-field">
                <label for="workflow-name-input">Name</label>
                <input id="workflow-name-input" type="text" autocomplete="off" spellcheck="false" placeholder="Daily inbox scan" />
              </div>
              <div class="settings-field">
                <label for="workflow-agent-select">Agent</label>
                <select id="workflow-agent-select" class="provider-select"></select>
              </div>
              <div class="settings-field">
                <label for="workflow-mode-select">Mode</label>
                <select id="workflow-mode-select" class="provider-select">
                  <option value="auto">Auto</option>
                  <option value="chat">Chat</option>
                  <option value="live">Live</option>
                </select>
              </div>
              <div class="settings-field">
                <label for="workflow-skills-input">Skill Hints (comma-separated)</label>
                <input id="workflow-skills-input" type="text" autocomplete="off" spellcheck="false" placeholder="playwright,linear" />
              </div>
              <div class="settings-field">
                <label for="workflow-goal-input">Goal / Prompt Template</label>
                <textarea id="workflow-goal-input" rows="3" spellcheck="false" placeholder="Describe what this workflow should do"></textarea>
              </div>
              <div class="settings-inline settings-toggle-line">
                <input id="workflow-enabled-input" type="checkbox" />
                <label for="workflow-enabled-input">Enabled</label>
              </div>
              <div class="settings-actions">
                <button id="workflow-to-input-btn" class="icon-btn">To Input</button>
                <button id="workflow-run-btn" class="send-btn">Run Workflow</button>
                <button id="workflow-save-btn" class="icon-btn">Save Workflow</button>
              </div>
              <div id="agents-workflow-note" class="settings-note">
                Use workflows to reuse multi-step tasks with selected agents. Template vars: {{input}}, {{date}}, {{time}}, {{datetime}}, {{channel}}, {{provider}}.
              </div>
            </section>

            <section
              id="settings-panel-permissions"
              class="settings-tab-panel"
              role="tabpanel"
              aria-labelledby="settings-tab-permissions"
              data-settings-panel="permissions"
            >
              <div class="settings-group-title">Runtime</div>
              <div id="runtime-health-note" class="settings-note">Runtime info loading...</div>

              <div class="settings-group-title">System Permissions</div>
              <div class="permission-grid">
                <div class="permission-card" data-permission-card="microphone">
                  <div class="permission-card-head">
                    <span class="permission-title">Microphone</span>
                    <span id="permission-status-microphone" class="permission-status">Unknown</span>
                  </div>
                  <div class="permission-note">Voice input transcription requires this permission.</div>
                  <div class="settings-inline">
                    <button id="permission-request-microphone" class="icon-btn">Request</button>
                    <button id="permission-open-microphone" class="icon-btn">Open Settings</button>
                  </div>
                </div>

                <div class="permission-card" data-permission-card="screen">
                  <div class="permission-card-head">
                    <span class="permission-title">Screen Recording</span>
                    <span id="permission-status-screen" class="permission-status">Unknown</span>
                  </div>
                  <div class="permission-note">Live watch and automation OCR require this permission.</div>
                  <div class="settings-inline">
                    <button id="permission-request-screen" class="icon-btn">Check</button>
                    <button id="permission-open-screen" class="icon-btn">Open Settings</button>
                  </div>
                </div>

                <div class="permission-card" data-permission-card="accessibility">
                  <div class="permission-card-head">
                    <span class="permission-title">Accessibility</span>
                    <span id="permission-status-accessibility" class="permission-status">Unknown</span>
                  </div>
                  <div class="permission-note">Desktop click/type control requires Accessibility trust.</div>
                  <div class="settings-inline">
                    <button id="permission-request-accessibility" class="icon-btn">Request</button>
                    <button id="permission-open-accessibility" class="icon-btn">Open Settings</button>
                  </div>
                </div>

                <div class="permission-card" data-permission-card="automation">
                  <div class="permission-card-head">
                    <span class="permission-title">Automation</span>
                    <span id="permission-status-automation" class="permission-status">Unknown</span>
                  </div>
                  <div class="permission-note">AppleScript control is granted by macOS per target app on first run.</div>
                  <div class="settings-inline">
                    <button id="permission-request-automation" class="icon-btn">Request</button>
                    <button id="permission-open-automation" class="icon-btn">Open Settings</button>
                  </div>
                </div>
              </div>

              <div class="settings-actions">
                <button id="permission-refresh-btn" class="icon-btn">Refresh</button>
              </div>
            </section>

            <section
              id="settings-panel-about"
              class="settings-tab-panel"
              role="tabpanel"
              aria-labelledby="settings-tab-about"
              data-settings-panel="about"
            >
              <div class="settings-group-title">Product</div>
              <div class="settings-note about-note">
                <a id="about-product-home-link" href="#" class="about-link">打开 manman 产品介绍页</a>
              </div>
              <div class="settings-group-title">Help</div>
              <div class="settings-note about-note">
                <a id="about-readme-link" href="#" class="about-link">打开 README 文档</a>
              </div>
              <div class="settings-group-title">Developer</div>
              <div class="settings-note about-note">
                <div><strong>Name:</strong> pickkkiy</div>
                <div><strong>Email:</strong> pickkki_y@163.com</div>
                <div><strong>Douyin:</strong> pickkkiy</div>
                <div><strong>Bilibili:</strong> pickkkiy</div>
                <div><strong>Xiaohongshu:</strong> pickkkiy</div>
              </div>
            </section>
          </div>
        </div>
      </div>
    </div>

    <script src="./chat.js"></script>
  </body>
</html>
